# 1장. 오늘날의 보안

## 스프링 시큐리티: 개념과 장점

스프링 시큐리티는 인증과 접근 제어를 위해 세부적인 맞춤 구성이 가능한 강력한 프레임워크이다.  
 - 깃허브: https://github.com/spring-projects/spring-projects/spring-security
 - 라이선스: 아파치 2.0 라이선스

<br/>

## 웹 애플리케이션의 일반적인 보안 취약성

 - OWASP: https://www.owasp.org
    - 인증 취약성
    - 세션 고정
    - XSS(교차 사이트 스크립팅)
    - CSRF(사이트 간 요청 위조)
    - 주입
    - 기밀 데이터 노출
    - 메서드 접근 제어 부족
    - 알려진 취약성이 있는 종속성 이용

 - __인증과 권한 부여의 취약성__

인증(Authentication)은 애플리케이션이 이를 이용하려는 사람을 식별하는 프로세스를 말한다.  
권한 부여(Authorization)는 인증된 호출자가 특정 기능과 데이터에 대한 이용 권리가 있는지 확인하는 프로세스를 말한다.  
인증 취약성이 있다는 것은 사용자가 악의를 가지고 다른 사람의 기능이나 데이터에 접근할 수 있다는 의미다.  

스프링 시큐리티를 이용해 특정 역할이 있는 인증된 사용자만 특정 엔드포인트에 접근하도록 정의할 수 있다.  

 - __세션 고정__

세션 고정(Session fixation) 취약성이 존재하면 공격자는 이미 생성된 세션 ID를 재이용해 유효한 사용자를 가장할 수 있다. 이 취약성은 웹 애플리케이션이 인증 프로세스 중에 고유한 세션 ID를 할당하지 않아 기존 세션 ID가 재사용될 가능성이 있을 때 발생한다.  

 - __XSS(교차 사이트 스크립팅)__

XSS(교차 사이트 스크립팅)는 서버에 노출된 웹 서비스로 클라이언트 쪽 스크립트를 주입해 다른 사용자가 이를 실행하도록 하는 공격이다. 이 취약성이 악용되면 계정 가장이나 DDoS와 같은 분산 공격 참여 등의 결과가 발생할 수 있다.  

따라서 원치 않는 외래 스크립트의 실행 방지를 위해 이용하기 전이나 심지어 저장하기 전에 요청을 적절하게 소독하는 과정이 필요하다.  

```
1. 인기가 많은 사이트 댓글창에 악성 스크립트 댓글을 단다.
<script>
    ..
</script>
```

<br/>

 - __CSRF(사이트 간 요청 위조)__

CSRF(사이트 간 요청 위조) 공격은 특정 서버에서 작업을 호출하는 URL을 추출해 애플리케이션 외부에서 재사용할 수 있다고 가정한다. 서버가 요청의 출처를 확인하지 않고 무턱대로 실행하면 다른 모든 곳에서 요청이 실행될 수 있다. 공격자는 CSRF를 통해 동작을 숨겨서 사용자가 서버에서 원치 않는 동작을 실행하도록 할 수 있다.  

 - __웹 애플리케이션의 주입 취약성__

주입 공격에서 공격자는 시스템에 특정 데이터를 주입하는 취약성을 이용한다. 공격의 목표는 시스템에 피해를 주고, 원치 않는 방법으로 데이터를 변경하거나 원래는 접근할 수 없는 데이터를 검색하는 것이다.  
주입 공격에는 여러 가지 유형이 있으며, XSS, SQL 주입, XPath 주입, OS 명령 주입, LDAP 주입 등이 있다.  

애플리케이션을 LDAP 주입에 취약하게 구축했다면 공격자는 인증을 우회하고 시스템의 중요한 부분을 통제할 수 있다.  
애플리케이션에 SQL 주입 취약성이 있는 경우 공격자는 다른 SQL 쿼리를 변경하거나 실행해서 시스템의 데이터 변경, 삭제 또는 추출할 수 있다.  

 - __민감한 데이터의 노출 처리하기__

민감한 정보를 스프링 프로젝트의 application.properties 파일 등의 구성 파일에서 설정하면 소스 코드를 볼 수 있는 모든 사람이 개인 값에 접근할 수 있다. 또한, 소스 코드의 버전 관리 시스템에도 이러한 값의 변경 기록이 저장될 수 있다.  
또한, 애플리케이션에 예외가 발생했을 때 서버가 클라이언트에 반환하는 정보에 주의할 필요가 있다. 이 애플리케이션 동작도 데이터 노출을 통한 취약성이다. 만약, 잘못된 요청에 의한 NullPointerException이 발생하는 경우 HTTP 상태는 500이 아닌 400이어야 하며, 응답 본문에 예외가 나오지 않도록 해야 한다.  
또한, 예외 메시지에 IP 주소가 공개되어서도 안 된다. 공격자는 이 주소와 다른 노출된 정보를 수집하여 네트워크 구성을 파악하고 최종적으로 인프라의 VM을 통제하는 방법을 찾아낼 수 있다.  

 - __메서드 접근 제어 부족__

애플리케이션 수준에도 한 계층에만 권한 부여를 적용하면 안 된다. 때에 따라서는 특정 기능을 아예 호출할 수 없게 해야 한다.  
