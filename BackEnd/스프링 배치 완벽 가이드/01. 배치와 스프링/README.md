# 01장. 배치와 스프링

## 스프링 배치 역사

배치 처리는 상호작용이나 중단 없이 유한한 양의 데이터를 처리한다.  
배치 처리가 시작되면 아무런 개입 없이 어떤 형태로든 완료된다.  

2007년 액센츄어사는 자사의 풍부한 메인프레임 및 배치 처리 경험을 바탕으로, 오픈소스 프레임워크를 만들고자 Interface21(현재 피보탈)과 파트너십을 맺었다.  
2008년 3월에는 스프링의 인기와 기능을 결합해 견고하고 사용하기 쉬운 스프링 배ㅊ치 1.0.0을 출시했다.  
2009년 4월에는 스프링 배치 2.0.0이 출시되었고, JDK 1.5 사용과 청크 기반 처리, 개선된 구성 옵션, 다양한 확장성 옵션 등 기능이 추가되었다.  
2014년에는 스프링 배치 3.0.0이 출시되었고, 새로운 자바 배치 표준인 JSR-352를 구현하였다.  

<br/>

## 스프링 배치 프레임워크

스프링 배치 프레임워크는 일반적인 배치패턴 및 패러다임을 구현하는 표준 기반 방법으로 엑센츄어사와 스프링소스사 간의 협업으로 개발되었다.  
스프링 배치에는 데이터 유효성 검증, 출력 포매팅, 복잡한 비즈니스 규칙을 재사용 가능한 방식으로 구현하는 기능, 대규모 데이터셋 처리 기능이 구현되어 있다.  

스프링 배치는 레이어 구조로 조립된 세 개의 티어로 이루어져 있다.  
가장 바깥쪽에 __애플리케이션 레이어__ 가 있으며, 배치 처리 구축에 사용되는 모든 사용자 코드 및 구성이 해당 레이어에 포함된다. 업무 로직과 서비스, 잡 구조화 관련 구성 등도 애플리케이션 레이어에 포함된다.  
__코어 레이어__ 에는 배치 도메인을 정의하는 모든 부분이 포함된다. 코어 컴포넌트의 요소에는 잡, 스텝 인터페이스와 집 샐행에 사용되는 인터페이스(JobLauncher, JobParameters) 등이 있다.  
모든 것의 밑에는 __인프라스트럭처 레이어__ 가 있다. 어떤 처리를 수행하려면 파일, 데이터베이스 등으로부터 읽고 쓸 수 있어야 하고, 잡 수행에 실패한 이후 재시도될 때 어떤 일을 수행할지를 다룰 수 있어야 한다. 이러한 부분은 공통 인프라스트럭처로 간주되며, 프레임워크의 인프라스트럭처 컴포넌트 내에 들어 있다.  

<br/>

## 스프링 배치 기초 개념

스프링 배치 처리에는 다양한 도메인 특화 개념이 있다.  
잡은 중단이나 상호작용 없이 처음부터 끝까지 실행되는 처리이다.  
잡은 여러 개의 스텝이 모여 이루어질 수 있다. 각 스텝에는 관련된 입력과 출력이 있을 수 있다.  

스프링 배치는 자바를 이용해 이런 개념을 정의하는 클래스, 인터페이스, XML 스키마, 자바 구성 유틸리티를 제공한다.  

 - 스프링으로 잡 정의하기
    - AccountTasklet은 커스텀 컴포넌트로, 스텝이 동작하는 동안에 비즈니스 로직을 수행한다. 스프링 배치는 AccountTasklet이 완료될 때까지 단일 메서드(execute())를 반복해서 호출하는데, 이때 각각 새 트랜잭션으로 호출된다.
    - 팩토리가 제공하는 빌더를 사용해 AccountTasklet을 감싸는 스텝 하나를 생성한다. 스프링 부트 애플리케이션 기동 시에 해당 잡을 찾아 자동으로 실행시킨다.
```Java
@Bean
public AccountTasklet accountTasklet() {
    return new AccountTasklet();
}

@Bean
public Job accountJob() {
    Step accountStep = 
        this.stepBuilderFactory
            .get("accountStep")
            .tasklet(accountTasklet())
            .build();
    
    return this.jobBuilderFactory
                .get("accountJob")
                .start("accountStep")
                .build();
}
```

<br/>

 - __로컬 및 원격 병렬화__

배치 잡은 규모를 확장할 수 있어야 한다. 스프링 배치는 각 커밋 간격 내의 처리를 쓰레드 풀에서 가져온 자체 쓰레드에서 처리하는 단순한 쓰레드 기반 방식과 병렬 청크/스텝 처리, 원격 청크 처리, 파티셔닝 기능을 포함하며, 모든 스텝을 병렬로 실행하기, 파티셔닝을 통해 원격 마스터로부터 작업 단위를 제공받는 워커의 그리드를 구성하기 등 다양한 옵션을 제공한다.  

 - __I/O 표준화하기__

복잡한 형식의 플랫 타입, XML 파일, 데이터베이스 또는 NoSQL 저장소 내에 저장돼 있는 데이터를 읽거나 파일이나 XML에 데이터를 쓰는 일에 대해서 스프링 배치의 간단한 구성만으로 수행할 수 있다.  

 - __스프링 클라우드 태스크__

스프링 클라우드 태스크는 스프링 클라우드의 하위 프로젝트로 클라우드 환경에서 한정된 태스크를 실행하는 여러 기능을 제공한다.  
스프링 클라우드 태스크는 정보성 메시지(잡 시작/종료, 스텝 시작/종료)를 제공하는 기능과 배치 잡을 동적으로 확장하는 기능을 포함해 스프링 배치의 다양한 확장 기능을 제공한다.  

 - __스프링 클라우드 데이터 플로우__

스프링 클라우드 데이터 플로우 프로젝트는 클라우드 플랫폼에서 마이크로서비스를 오케스트레이션하는 도구다.  
배치 애플리케이션을 마이크로서비스로 개발하면 스프링 클라우드 데이터 플로우를 사용해 동적으로 배포할 수 있다.  
