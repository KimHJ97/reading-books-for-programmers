# 문자열 인코딩

## 1. 문자열 인코딩

__문자열 인코딩이란 2진법을 사용하는 컴퓨터가 인간의 언어를 일정한 규칙에 따라 2진수로 변환하는 방식입니다.__  

컴퓨터는 사람의 언어를 그대로 읽거나 처리할 수 없다. 때문에, 사람들이 만든 2진수와 문자를 일대일로 대응하는 규칙을 통해 2진수로 문자를 처리한다.  

컴퓨터가 처음 등장했을 때 모든 프로그램은 영어와 일부 특수 문자만을 지원했습니다. 그러나 여러 국가에서 컴퓨터를 사용하기 위해 국가별로 사용하는 언어를 표현하고자 독자적인 규칙을 만들기 시작했습니다. 이렇게 모든 개발 환경이 문자열을 동일하게 처리하지 않아 문자열이 깨지는 경우가 발생합니다.  

이러한 문제를 해결하기 위해 모든 언어를 같은 규칙으로 표현할 수 있는 유니코드 방식이 등장합니다.  

<br/>

## 2. 아스키 코드(ASCII)

__아스키 코드(ASCII)는 처음으로 표준을 정립한 문자열 인코딩 방식으로 대문자, 소문자, 아라비아 숫자, 공백 및 특수 문자를 표현할 수 있습니다.__  

 - 65 ~ 90(ASCII): A ~ Z
 - 48 ~ 57(ASCII): 0 ~ 9

<br/>

아스키 코드에는 숫자를 나타내는 문자가 있습니다. 컴퓨터는 2진수 데이터를 한 가지 형태(10진수, 16진수, 문자 등)로만 인식할 수 있기 때문에 숫자와 문자를 동시에 인식할 수 없습니다. 이러한 문제를 해결하기 위해 숫자를 나타내는 문자들을 만들었습니다.  

아스키 코드는 영어를 제외한 다른 언어를 표현할 수 없습니다. 때문에, 각 나라에서 컴퓨터를 사용하기 시작했을 때는 아스키 코드 대신 독자적인 문자 집합과 인코딩 방식을 만들어 사용했습니다.  

<br/>

## 3. EUC-KR(CP949)

__우리나라에서는 컴퓨터로 한글을 표현하는 방법으로 EUC-KR 문자 집합을 만들었습니다. EUC-KR은 한국 산업 표준으로 지정된 한국어 문자 집합으로 문자 하나를 표현하기 위해 2바이트를 사용합니다.__  

EUC-KR은 모든 글자가 완성된 형태로만 존재하는 완성형 코드입니다. 따라서 한글처럼 초성, 중성, 종성을 조합해 문자를 만들 수 없기 때문에 EUC-KR로 표현할 수 없는 한글이 일부 존재합니다.  

유니코드 2.0 버전에서 초성, 중성, 종성에 해당하는 코드로 나눠 표현하는 조합형 글자를 만들면 EUC-KR로 표현할 수 없는 글자들을 만들 수 있습니다.  

 - EUC-KR로 아스키 코드 영역에 있는 글자를 표현할 때는 1바이트를 사용한다.
 - 한글 문자를 표현할 때는 2바이트를 사용한다.

<br/>

## 4. 유니코드(UTF-8, UTF-16, UTF-32)

과거에는 EUC-KR 처럼 국가별로 독자적인 문자 집합과 인코딩 방식을 사용했습니다. 때문에, 전 세계 사용자를 대상으로 하는 프로그램이나 웹 페이지를 만들기 위해서는 언어별로 다른 인코딩 방식을 사용해야 했습니다.  

__국가별로 독자적인 문자열 인코딩을 사용하는 문제를 해결하기 위해 국제 표준화 기구(ISO)에서 동일한 규칙으로 모든 언어를 표현할 수 있는 유니코드 문자 집합을 만들었습니다.__  최초 버전인 1.0은 1991년에 제정됐고, 이후 여러 언어를 추가하면서 계속해서 개정이 되고 있습니다.  

유니코드 문자 집합을 표현하는 문자열 인코딩은 UTF-8, UTF-16, UTF-32 3가지가 있습니다.

<br/>

## 5. UTF-8

UTF-8은 8비트(1바이트)로 인코딩하는 것을 의미합니다.  
UTF-8은 아스키코드와 완벽하게 호환되며, 표현하려는 문자에 따라 최소 1바이트에서 최대 6바이트까지 사용합니다.  

 - __보통 일반적인 문자는 3바이트 내로 처리되며, 4바이트 영역에는 이모지 같은 문자가 있습니다.__
 - 고대 문자 같은 것을 사용하지 않는 한 5바이트 이상을 쓰는 경우는 거의 없습니다.

<br/>

### UTF-8 표현 규칙

1바이트를 사용하는 경우에는 '0xxxxxxx'로 7비트로 문자를 표현합니다. 이때, 0 ~ 127까지의 수로 문자를 표현하는 아스키와 같은 규칙을 사용하므로 UTF-8은 아스키 코드와 완벽히 호환됩니다.  

2바이트를 사용하는 경우에는 '110xxxxx', '10xxxxxx' 총 11비트로 UTF-8 문자를 만들 수 있습니다.  

3바이트를 사용하는 경우에는 '1110xxxx', '10xxxxxx', '10xxxxxx' 총 16비트로 UTF-8 문자를 만들 수 있습니다.  

 - 위키피디아 UTF-8: https://ko.wikipedia.org/wiki/UTF-8
 - 1바이트로 표시된 문자의 최상위 비트는 항상 0이다.
 - 2바이트 이상으로 표시된 문자의 경우, 첫 바이트의 상위 비트들이 그 문자를 표시하는 데 필요한 바이트 수를 결정한다. 예를 들어서 2바이트는 110으로 시작하고, 3바이트는 1110으로 시작한다.
 - 첫 바이트가 아닌 나머지 바이트들은 상위 2비트가 항상 10이다.

<br/>

### UTF-8 문자열 예시

 - 'Hello'는 아스키 코드와 모두 호환되어 5 바이트를 사용한다.
 - '안녕하세요'는 총 15바이트를 사용한다.

```python
#!/usr/bin/python3

def print_text(text, encoding_type):
  byte_data = text.encode(encoding_type)
  hex_data_as_str = ' '.join("{0}".format(hex(c)) for c in byte_data)
  int_data_as_str = ' '.join("{0}".format(int(c)) for c in byte_data)

  print('\'' + text + '\' 전체 문자 길이: {0}'.format(len(text)))
  print('\'' + text + '\' 전체 문자를 표현하는 데 사용한 바이트 수: {0} 바이트'.format(len(byte_data)))
  print('\'' + text + '\' 16진수 값: {0}'.format(hex_data_as_str))
  print('\'' + text + '\' 10진수 값: {0}'.format(int_data_as_str))


print_text('Hello', 'utf-8')
print_text('안녕하세요', 'utf-8')
```
<br/>

## 6. UTF-16

UTF-16은 16비트(2바이트)로 인코딩하는 것을 의미합니다.  
UTF-16은 2바이트 또는 4바이트만 사용하기 때문에 아스키 코드와 호환되지 않습니다.  
유니코드에는 문자의 종류에 따라 기본 다국어 평면(BMP), 보충 다국어 평면(SMP), 상형 문자 보충 평면(SIP), 특수 목적 보충 평면(SSP) 등 평면 4개가 있고, 바이트 수는 표현하려는 문자가 어떤 평면에 속한는지에 따라 결정됩니다.  

 - UTF-16은 일반 글자를 2바이트, 특별한 글자를 4바이트를 사용해 인코딩합니다.

<br/>

### UTF-16 문자열 출력

 - 'Hello'와 '안녕하세요'는 총 12바이트를 사용한다.
 - 일반 글자를 표현할 때 2바이트를 사용한다. 하지만, 12바이트가 사용되었는데 맨 앞에 0xff, 0xfe가 추가되었다.

```python
#!/usr/bin/python3

def print_text(text, encoding_type):
  byte_data = text.encode(encoding_type)
  hex_data_as_str = ' '.join("{0}".format(hex(c)) for c in byte_data)
  int_data_as_str = ' '.join("{0}".format(int(c)) for c in byte_data)

  print('\'' + text + '\' 전체 문자 길이: {0}'.format(len(text)))
  print('\'' + text + '\' 전체 문자를 표현하는 데 사용한 바이트 수: {0} 바이트'.format(len(byte_data)))
  print('\'' + text + '\' 16진수 값: {0}'.format(hex_data_as_str))
  print('\'' + text + '\' 10진수 값: {0}'.format(int_data_as_str))


print_text('Hello', 'utf-16')
print_text('안녕하세요', 'utf-16')
```
<br/>

### 바이트 순서 표시

UTF-16과 UTF-32는 바이트 순서 표시(BOM)을 사용합니다.  
BOM은 문자열 가장 맨 앞 2바이트에 0xEFEFF(유니코드로 U+FEFF)로 표기하여 사용한다. 또한, 0xFE와 0xFF 중 어떤 문자가 먼저 오는지에 따라 리틀 엔디언과 빅 엔디언으로 나뉩니다.  

BOM을 이용하여 바이트 표현 순서를 정하는 이유는, CPU 설계에 따라 바이트 값을 처리하는 순서가 다르기 때문입니다.  

<br/>

## 7. 정리

 - __UTF-8__
    - 오늘날 가장 많이 사용하는 문자열 인코딩으로 최소 1바이트, 최대 6바이트를 사용합니다.
    - 아스키 코드와 호환 가능합니다.
    - JSON은 UTF-8 인코딩만 사용하며, 다른 문자열 인코딩은 표준에서 지원하지 않습니다.
 - __UTF-16__
    - 자바와 윈도우는 유니코드를 사용하기 전부터 고정된 2바이트 길이의 문자 집합을 사용했습니다. 그래서 UTF-16은 멀티 바이트라고도 합니다. 두 환경에서의 호환성 외에 UTF-16을 사용할 별다른 이유는 없습니다.
    - 2바이트 또는 4바이트 길이의 문자열을 사용하며, 아스키 코드와 호환되지 않습니다.
    - 만약, UTF-16을 사용하는 경우 UTF-16와 UTF-8의 사용 영역을 명확하게 구분해야 합니다. 예를 들어, 자바 웹 기반 서비느느 UTF-16을 사용하되, 외부 데이터베이스와 브라우저 간 통신 시 UTF-8로 변환하여 사용해야 합니다.
 - __UTF-32__
    - 4바이트를 고정적으로 사용합니다.
    - 반드시 UTF-32를 사용해야 하는 환경이 아니라면 사용하지 않습니다.
 - __EUC-KR__
    - 한국에서 독자적으로 사용하는 문자열 인코딩으로 고정된 2바이트를 사용합니다.
 - __그 외 좋은 내용__
    - MySQL의 UTF-8 타입에는 utf8과 utf8mb4가 있다. utf8은 3바이트까지 정상으로 처리하나, 4바이트 영역 문자는 처리하지 못한다. 따라서, UTF-8과 완벽히 호환되는 문자 집합을 쓰고 싶다면 utf8mb4를 써야한다.

