# 날짜와 시간

## 1. 타임스탬프

타임스탬프는 컴퓨터가 시간을 표현하기 위해 사용하는 값으로 1970년 1월 1일 0시 0분 0초부터 1초 단위로 증가합니다.  

컴퓨터가 타임스탬프로 표현할 수 있는 시간은 두 종류가 존재합니다. 하나는 단조 시간으로 컴퓨터가 직접 계산하는 시간이고, 다른 하나는 우리가 사는 세계의  실제 시간입니다. 두 종류의 시간은 사용 용도가 다르기 떄문에 용도에 맞게 잘 사용해야 합니다.  

## 2. 단조 시간

단조 시간은 운영체제 또는 CPU와 같은 하드웨어에서 직접 계산하는 시간입니다.  
외부 요인에 의해 바뀌지 않는 단조 시간의 특징을 이용하면 불변성을 보장하는 시간 값이 필요할 때 유용하게 사용할 수 있습니다. 예를 들어, 주기적으로 수행해야 하는 작업이 있을 때, 단조 시간 값을 가져와 비교하면 항상 동일한 주기로 작업을 실행할 수 있습니다.  

```python
#!/usr/bin/python3

import time

# t1 시간 기록 (현재)
t1 = time.monotonic()

while True:
    # t2 시간 기록
    t2 = time.monotonic()
    # 이 루프가 3초 이상 실행된 경우 종료합니다.
    if t2 >= t1 + 3:
        break

    time.sleep(0.1)

# 실제 시간 차이를 출력합니다.
print("t1={0}".format(t1))
print("t2={0}".format(t2))
print("diff={0}".format(t2-t1))
```
<br/>

## 3. 실제 시간

실제 시간도 컴퓨터가 직접 계산하지만 주기적으로 시간 서버로부터 값을 가져와 동기화하기 떄문에 언제든지 시간이 바뀔 수 있습니다.  

 - 단조 시간으로도 한 달을 잴 수는 있지만, 한달은 30일과 31일이 있고 윤년도 염두에 두고 계산해야 합니다. 따라서, 한 달 이상 주기를 두고 실행하는 작업은 실제 시간을 기준으로 하는 게 좋습니다.

## 4. 타임 존

__실제 시간을 사용할 때는 타임 존 설정을 확인해야 합니다. 나라마다 사용하는 표준 시간이 다르기 때문입니다.__  

 - 한국은 UTC+9 시간을 기준으로 시간을 표현한다.
 - 협정 세계시(UTC)를 그리니치 평균시(GMT) 라고도 합니다. GMT와 UTC의 차이는 없지만, GMT는 여러 타임 존 중 하나일 뿐이고 UTC는 표준 시간을 뜻하기 떄문에 UTC로 표기하는 게 옳다.

```python
#!/usr/bin/python3

import datetime

# 시스템 기본 시간
t1 = datetime.datetime.now()
# UTC 시간
t2 = datetime.datetime.now(tz=datetime.timezone.utc)

print("시스템 기본 시간: {0}".format(t1))
print("UTC 시간: {0}".format(t2))
```
<br/>

#### 타임 존 설정을 유의해야 하는 이유

타임 존은 운영체제 또는 모바일 기기 설정에 의해 언제든지 바뀔 수 있으며, 브라우저와 같은 요청 클라이언트의 설정이나 지역에 따라 타임 존이 바뀌기도 합니다.  

여러 프로그램 간 사용하는 시스템의 시간이 다르면 문제가 발생할 수 있습니다. A 서버는 UTC+9, B서버는 UTC를 사용한다고 가정했을 때, A서버가 B서버로 수행할 작업과 작업 수행 시간을 보낸다면 A는 9시간 뒤 작업 요청을 보냈지만 B 서버는 18 시간 뒤에 작업을 처리하게 됩니다.  

즉, 두 서버 간 시간 차이로 발생하는 오동작을 방지하려면 전체 서비스를 구성하는 여러 프로그램이나 서버 간 동일한 타임존을 사용해야 합니다.  

<br/>

## 5. 정리

 - 단조 시간은 실제 시간으로 사용할 수 없지만, 불변성을 보장하므로 시간 차이를 계산할 떄 사용합니다.
    - 특정 작업을 수행하는 데 걸린 시간을 측정할 때
    - 일정한 주기로 작업을 수행할 때 (1달 미만)
 - 실제 시간 값은 서비스를 구성하는 모든 서버와 프로그램이 UTC를 사용하거나, 그렇게 하기 어렵다면 동일한 타임 존을 사용하는 게 좋습니다.
    - 타임존이 다르면, 여러 서버가 특정 시간에 동시에 수행하는 작업에 영향을 줄 수 있습니다. 또한, 서로 다른 두 서버의 로그를 함께 보기 어려워집니다.


