# 범용 고유 식별자

범용 고유 식별자(UUID)란 컴퓨터 시스템 내에서 고유한 객체를 식별하기 위해 사용하는 값입니다. 네트워크상에 존재하는 여러 컴퓨터를 식별하기 위해 사용하기 시작했습니다.  

<br/>

## 1. UUID 구조

UUID는 하이픈(-) 4개와 16진수 32개로 구성되었습니다.  
UUID는 32개의 16진수 모두 무작위로 만들기 때문에 같은 UUID를 만들 가능성이 매우 낮습니다. 그래서, 같은 값이 있으면 안 되는 고유 식별자를 만들 떄 사용하기 좋습니다.  
 - 100경 개의 UUID를 생성했을 때 1쌍의 UUID가 충돌할 확률이 50%라고 한다.

<br/>

## 2. UUID 버전

UUID는 버전별로 사용 방법과 규칙이 다릅니다.  

 - __버전 1과 버전2__
    - 초창기 버전의 UUID로 네트워크에 있는 고유한 컴퓨터들을 식별할 떄 사용했습니다.
    - 버전 1은 컴퓨터의 맥 주소와 타임스탬프 값을 기반으로 UUID를 생성했고, 버전 2는 규모가 큰 시스템 환경을 고려해 자릿수 일부를 지역별로 정의로 남겨뒀습니다.
    - 하지만, 맥 주소와 타임스탬프 값으로 서버를 식별하는 건 한계가 있다. 마이크로 서비스 아키텍처는 맥 주소가 달라도 같은 서버로 인식해야 하고, 도커와 같은 가상 서버는 같은 맥 주소를 가진 여러 서버를 동시에 생성할 수도 있다.
 - __버전 3과 버전5__
    - 버전 3과 버전 5는 네임스페이스와 문자열을 받아 해시 함수를 사용해 UUID로 변환합니다. 입력값이 같으면 UUID도 같다는 특성이 있으며, 해시 충돌을 막기 위해 별도의 네임스페이스 UUID를 받습니다.
    - 버전 3의 UUID는 MD5를, 버전 5는 SHA-1를 기반으로 한다.
 - __버전 4__
    - 오늘날 가장 많이 사용하는 UUID
    - 버전을 표기하는 4비트를 제외한 나머지 122비트를 모두 무작위로 생성한다.

<br/>

## 3. 실사용 예

### 작업 식별자

논리적인 작업은 웹 페이지, RESTful API 요청, 파일 업로드, 상품 주문 처리 등 여러 형태가 될 수 있습니다.  

웹 페이지 요청, 상품 주문, 결제 등의 작업은 짧게 수 초, 길게 몇 시간 또는 며칠이 걸린다. 작업 시간이 길어질수록 프로세스나 사용하는 함수가 많이지기 때문에 복잡한 작업을 추적하기 위해 반드시 고유한 ID가 필요하다. 또한, 작업 요청은 동시에 수십, 수백 개가 생길 수 있어 동일한 작업 식별자를 생성하는 일도 낮아야 한다. 이런 이유로 논리적인 작업을 만들고 추적할 때는 충돌 확률이 낮고 고유한 식별자를 사용할 수 있는 UUID를 사용하는 게 좋다.  

 - 요청마다 UUID를 만들기
    - 생성한 UUID는 요청이 끝나기 전이나 논리적인 작업이 끝나기 전까지 가지고 있거나 요청으로 만든 작업과 함께 데이터베이스에 넣어 관리할 수 있다.
```python
#!/usr/bin/python3
# 다음 코드를 실행하기 위해서는 flask 모듈이 필요합니다.

import uuid
from flask import Flask
app = Flask(__name__)


@app.route('/')
def hello():
    request_id = uuid.uuid4()
    print('API 요청 ID={0}'.format(request_id))
    return 'Hello World'


if __name__ == '__main__':
    app.run()
```

