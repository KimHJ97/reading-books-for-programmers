# ALB와 NLB

AWS에서 제공하는 로드 밸런서에는 Application Load Balancer(ALB)와 Network Load Balancer(NLB)가 있습니다.  

ALB 로드 밸런스를 확인하면 IP 주소는 없고 도메인 주소만 나와있다. 브라우저를 통해 도메인 주소에 접근하여 개발자 콘솔의 Network 창의 Remote Address로 ALB의 실제 IP 주소를 확인할 수 있지만, 로드 밸런서 정보에서는 확인할 수 없다. ALB는 기본적으로 DNS 주소를 제공하여 클라이언트에 트래픽을 분산하는 서비스를 제공하며, IP 주소가 자동으로 만들어지고 주기적으로 변경된다. 클라이언트가 기본적으로 도메인으로 접근하여 IP 주소가 변경되어도 상관이 없지만, 오래된 디바이스나 보안에 엄격한 네트워크 관리자에겐 까다롭게 여겨질 수 있다.  

때문에, AWS에서는 4계층 TCP 로드 밸런서인 네트워크 로드 밸런서(NLB)를 제공한다. NLB는 각 가용 영역에 고정 IP 주소들을 두고 쓸 수 있다. NLB는 TCP 통신만 허용하기 때문에 HTTPS를 처리나 7계층 관련 기능을 하지 못하지만, 고정 IP를 받을 수 있다.  

즉, ALB 앞단에 NLB를 두고, 외부에서 클라이언트는 IP가 고정되어 있는 NLB로 접속하도록 구성한다.

 - `흐름 정리`
   - NLB(Network Load Balancer): 고정 IP를 받을 수 있음
   - ALB(Application Load Balancer): IP 주소가 있지만, 주기적으로 변경되어 컨트롤할 수 없음
   - Auto Scaling 그룹: EC2 2대가 기본적으로 활성화되어 있고, 최대 4대까지 활성화 (EC2에는 Nginx 80, Spring 5000 포트 리스닝)
   - RDS: 3306 포트로 로컬 IP와 EC2가 묶인 보안 그룹이 접근 가능하도록 허용
 - `Application Load Balancer (ALB)`
   - 레이어 7 (애플리케이션 레이어) 로드 밸런서
      - HTTP 및 HTTPS와 같은 애플리케이션 레이어에서 동작하며, 웹 트래픽을 효과적으로 분배합니다.
   - HTTP/HTTPS 트래픽 라우팅
      - ALB는 다양한 라우팅 기능을 제공하여 특정 경로, 호스트, 헤더 등에 따라 트래픽을 다르게 분배할 수 있습니다.
   - 컨테이너 및 마이크로서비스 지원
      - 도커 및 Amazon ECS와 같은 컨테이너 환경, 그리고 AWS Lambda와 같은 서버리스 아키텍처를 지원합니다.
   - SSL 종료 및 인증서 관리
      - SSL/TLS 트래픽을 종료하고 백엔드 서버에는 암호화되지 않은 트래픽을 전달할 수 있습니다.
 - `Network Load Balancer (NLB)`
   - 레이어 4 (네트워크 레이어) 로드 밸런서
      - TCP 및 UDP와 같은 네트워크 레이어에서 동작하며, 로드 밸런싱을 수행합니다.
   - 고성능 및 초고첨단 트래픽 관리
      - 매우 고성능의 로드 밸런서로 수백만 개의 동시 연결을 처리할 수 있으며, 초고첨단 네트워크 성능을 제공합니다.
   - 고정 IP 지원
      - NLB는 고정 IP 주소를 제공하므로, 클라이언트가 항상 동일한 IP 주소로 연결할 수 있습니다.
   - TCP/UDP 세션 표시
      - NLB는 TCP 및 UDP 세션 표시와 같은 기능을 통해 백엔드 서버 간에 세션 일관성을 유지합니다.
   - 클라이언트 IP 보존
      - 원본 클라이언트의 IP 주소를 백엔드 서버에 보존하여 서버에서 정확한 클라이언트 정보를 추적할 수 있습니다.
